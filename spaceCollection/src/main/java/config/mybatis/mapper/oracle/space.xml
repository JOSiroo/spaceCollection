<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace 부분은 말그대로 별칭을 정하는 부분이라 아무렇게나 지정해도 된다  -->
<mapper namespace="com.sc.spaceCollection.space.model.SpaceDAO">
	<sql id="searchWhere">
		<if test="searchKeyword!=null and searchKeyword!=''">
			and ${searchCondition} like '%' || #{searchKeyword} || '%'
		</if>
	</sql>
	
	
	<select id="selectBySpaceType" resultType="map">
		select * 
		from(
			select A.*, rownum as rn
			from 
			(
				select * from SPACE_SD_AVERAGEPRICE_FACILITY_VIEW
				where space_Type_no = #{spaceTypeNo}
				<if test="region!=null and region!=''">
					and space_address like '%' || #{region} || '%'
				</if>
				<if test="maxPeople!=null and maxPeople!=''">
					<![CDATA[ and MAXPEOPLE >=  #{maxPeople} ]]>
				</if>
				<if test="minPrice!=null and minPrice!=''">
					<![CDATA[ and AVGPRICE >  #{minPrice} ]]> 
				</if>
				<if test="maxPrice!=null and maxPrice!=''">
					<![CDATA[ and AVGPRICE <  #{maxPrice} ]]> 
				</if>
				<if test="filterList!=null and filterList!=''">
				and
					<foreach item="item" collection="filterList" separator="and">
					   FAC_${item} = 'Y'
				    </foreach>
				</if>
				<if test="order!=null and order!=''">
					  <![CDATA[ ORDER BY ${order} ]]>
				</if>
			)A	
		)
		<![CDATA[
		where rn >= #{startRow} and rn <= #{endRow} ]]>
	</select>
	
	<select id="selectBySpaceName" resultType="map">
		select * 
		from(
			select A.*, rownum as rn
			from 
			(
				select * from SPACE_SD_AVERAGEPRICE_FACILITY_VIEW
				where space_Name like '%' || #{spaceName} || '%'
				<if test="region!=null and region!=''">
					and space_address like '%' || #{region} || '%'
				</if>
				<if test="maxPeople!=null and maxPeople!=''">
					<![CDATA[ and MAXPEOPLE >=  #{maxPeople} ]]>
				</if>
				<if test="minPrice!=null and minPrice!=''">
					<![CDATA[ and AVGPRICE >  #{minPrice} ]]> 
				</if>
				<if test="maxPrice!=null and maxPrice!=''">
					<![CDATA[ and AVGPRICE <  #{maxPrice} ]]> 
				</if>
				<if test="filterList!=null and filterList!=''">
				and
					<foreach item="item" collection="filterList" separator="and">
					   FAC_${item} = 'Y'
				    </foreach>
				</if>
				<if test="order!=null and order!=''">
					  <![CDATA[ ORDER BY ${order} ]]>
				</if>
			)A	
		)
		<![CDATA[
		where rn >= #{startRow} and rn <= #{endRow} ]]>
	</select>
	<select id="selectBySpaceTypeMap" resultType="spaceVo">
		select * from space
		where space_Type_no = #{spaceTypeNo}	
	</select>
	<select id="selectBySpaceNameMap" resultType="spaceVo">
		select * from space
		where space_Name like '%' || #{spaceName} || '%'	
	</select>
	
	<select id="selectBySpaceNum"  resultType="spaceVo">
		select * from space
		order by space_num desc 
		FETCH FIRST 9 row only
	</select>
	
	<select id="usercount" resultType="map" >
		SELECT * FROM user_counts_view
	</select>
	
	<select id="selectSpaceListViewByUserId" parameterType="searchVo" resultType="map">
		select * from
		(
			select rownum as RNUM, A.* from
			(
				select * from SPACE_LIST_VIEW where user_id = #{userId}
				<include refid="searchWhere"/>
				order by space_request_date
			)A
		)
		<![CDATA[
		where RNUM>#{firstRecordIndex} 
		and RNUM<=#{firstRecordIndex} + #{recordCountPerPage}]]>
	</select>
	
	<select id="getTotalRecordSpaceListViewByUserId" parameterType="searchVo" resultType="int">
		select count(*) from SPACE_LIST_VIEW where user_id = #{userId}
		<include refid="searchWhere"/>
	</select>
</mapper>
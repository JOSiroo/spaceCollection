<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sc.spaceCollection.host.model.HostDAO">
	<!-- 카테고리가 메인이고 resultmap에는 메인에 대한걸 작성 
	컬렉션은 select category에서 가져온 categoryno로 type을 조회한다. -->
	
	<select id="selectSpaceType" resultType="SpaceTypeVO" parameterType="int">
		select * from space_type
		where category_no = #{categoryNo}
		and SPACE_TYPE_DEL_FLAG is null
	</select>
	
	<resultMap type="SpaceCategoryAllVO" id="spaceTypeResultMap">
		<association property="spaceCategoryVo" column="categoryNo" javaType="SpaceCategoryVO" >
			<id property="categoryNo" column="category_no" jdbcType="BIGINT" />
			<result property="categoryName" column="category_name" jdbcType="VARCHAR" />
		</association>
		<collection property="spaceTypeList" javaType="ArrayList" ofType="map" 
			column="category_no" select="selectSpaceType">
		</collection>
	</resultMap>

	<select id="selectSpaceCategory" resultMap="spaceTypeResultMap">
		select * from space_type_category
		where CATEGORY_DEL_FLAG is null
		order by category_no
	</select>
	
	<select id="selectUserById" resultType="userInfoVo" parameterType="String">
		select * from user_info
		where user_id = #{userId}
	</select>
	
	<insert id="insertSpace">
		<selectKey keyProperty="spaceNum" order="BEFORE" resultType="int">
			select space_seq.nextval from dual
		</selectKey>
		insert into space(space_num, space_name, space_business_num, space_zipcode, space_address, 
		    space_address_detail, space_location, space_intro, space_info, space_tag, space_facility, 
		    space_phone_num, space_warn, latitude, longitude, user_num, space_type_no)
		values (#{spaceNum}, #{spaceName}, #{spaceBusinessNum}, #{spaceZipcode}, #{spaceAddress},
			#{spaceAddressDetail}, #{spaceLocation}, #{spaceIntro}, #{spaceInfo}, #{spaceTag}, 
			#{spaceFacility}, #{spacePhoneNum}, #{spaceWarn}, 11, 22, #{userNum}, #{spaceTypeNo})
	</insert>
	
	<select id="selectSpaceTypeBySpaceTypeName" resultType="spaceTypeVo" parameterType="String">
		select * from space_type
		where space_type_name = #{spaceTypeName}
	</select>
	
	
	
	<select id="selectHostReservation" resultType="map">
		select *
		from
		(
		    select rownum as rn, f.* 
		    from 
		    (
		        select * from host_reservation_view
		        where user_num = #{userNum}
		        <if test='status != null and status != ""'>
		        		and
		        	<if test="status == 'before'"><![CDATA[RESERVE_START_DAY >= sysdate ]]></if>
		        	<if test="status == 'finished'"><![CDATA[RESERVE_START_DAY <= sysdate ]]></if>
		        	<if test="status == 'canceled'">RESERVATION_DEL_FLAG = 'Y'</if>
		        </if>
		        <if test='keyword != "" and keyword != null'>
					and USER_ID like '%' || #{keyword} || '%'
		        </if>
		        <if test='order != null and order != ""'>
					order by ${order} asc       
		        </if>
		    )f
		)A
		<![CDATA[ 
		where rn >= #{startRow} and rn <= #{endRow} ]]>
	</select>
	<select id="HostReservationCalendar" resultType="map">
        select * from host_reservation_view
        where user_num = #{userNum}
	</select>
	<select id="getDataByDate" resultType="int">
		select RESERVE_PRICE from host_reservation_view
		where user_num = #{userNum} and RESERVE_START_DAY = #{date}
	</select>
</mapper>